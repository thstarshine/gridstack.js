!function(t){"function"==typeof define&&define.amd?define(["jquery","lodash","jquery-ui/core","jquery-ui/widget","jquery-ui/mouse","jquery-ui/draggable","jquery-ui/resizable"],t):t(jQuery,_)}(function(t,e){var i=window,n={is_intercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,i,n){return n=n||e.chain(t).map(function(t){return t.x+t.width}).max().value(),i=-1!=i?1:-1,e.sortBy(t,function(t){return i*(t.x+t.y*n)})},create_stylesheet:function(t){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-gs-id",t),e.styleSheet?e.styleSheet.cssText="":e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet},remove_stylesheet:function(e){t("STYLE[data-gs-id="+e+"]").remove()},insert_css_rule:function(t,e,i,n){"function"==typeof t.insertRule?t.insertRule(e+"{"+i+"}",n):"function"==typeof t.addRule&&t.addRule(e,i,n)},toBool:function(t){return"boolean"==typeof t?t:"string"==typeof t?(t=t.toLowerCase(),!(""==t||"no"==t||"false"==t||"0"==t)):Boolean(t)}},a=0,s=function(t,e,i,n,a){this.width=t,this["float"]=i||!1,this.height=n||0,this.nodes=a||[],this.onchange=e||function(){},this._update_counter=0,this._float=this["float"]};s.prototype.batch_update=function(){this._update_counter=1,this["float"]=!0},s.prototype.commit=function(){this._update_counter=0,0==this._update_counter&&(this["float"]=this._float,this._pack_nodes(),this._notify())},s.prototype._fix_collisions=function(t){this._sort_nodes(-1);var i=t,a=Boolean(e.find(this.nodes,function(t){return t.locked}));for(this["float"]||a||(i={x:0,y:t.y,width:this.width,height:t.height});;){var s=e.find(this.nodes,function(e){return e!=t&&n.is_intercepted(e,i)},this);if("undefined"==typeof s)return;this.move_node(s,s.x,t.y+t.height,s.width,s.height,!0)}},s.prototype.is_area_empty=function(t,i,a,s){var o={x:t||0,y:i||0,width:a||1,height:s||1},r=e.find(this.nodes,function(t){return n.is_intercepted(t,o)},this);return null==r},s.prototype._sort_nodes=function(t){this.nodes=n.sort(this.nodes,t,this.width)},s.prototype._pack_nodes=function(){this._sort_nodes(),this["float"]?e.each(this.nodes,function(t){if(!t._updating&&"undefined"!=typeof t._orig_y&&t.y!=t._orig_y)for(var i=t.y;i>=t._orig_y;){var a=e.chain(this.nodes).find(function(e){return t!=e&&n.is_intercepted({x:t.x,y:i,width:t.width,height:t.height},e)}).value();a||(t._dirty=!0,t.y=i),--i}},this):e.each(this.nodes,function(t,i){if(!t.locked)for(;t.y>0;){var a=t.y-1,s=0==i;if(i>0){var o=e.chain(this.nodes).take(i).find(function(e){return n.is_intercepted({x:t.x,y:a,width:t.width,height:t.height},e)}).value();s="undefined"==typeof o}if(!s)break;t._dirty=t.y!=a,t.y=a}},this)},s.prototype._prepare_node=function(t,i){return t=e.defaults(t||{},{width:1,height:1,x:0,y:0}),t.x=parseInt(""+t.x),t.y=parseInt(""+t.y),t.width=parseInt(""+t.width),t.height=parseInt(""+t.height),t.auto_position=t.auto_position||!1,t.no_resize=t.no_resize||!1,t.no_move=t.no_move||!1,t.width>this.width?t.width=this.width:t.width<1&&(t.width=1),t.height<1&&(t.height=1),t.x<0&&(t.x=0),t.x+t.width>this.width&&(i?t.width=this.width-t.x:t.x=this.width-t.width),t.y<0&&(t.y=0),t},s.prototype._notify=function(){if(!this._update_counter){var t=Array.prototype.slice.call(arguments,1).concat(this.get_dirty_nodes());t=t.concat(this.get_dirty_nodes()),this.onchange(t)}},s.prototype.clean_nodes=function(){e.each(this.nodes,function(t){t._dirty=!1})},s.prototype.get_dirty_nodes=function(){return e.filter(this.nodes,function(t){return t._dirty})},s.prototype.add_node=function(t){if(t=this._prepare_node(t),"undefined"!=typeof t.max_width&&(t.width=Math.min(t.width,t.max_width)),"undefined"!=typeof t.max_height&&(t.height=Math.min(t.height,t.max_height)),"undefined"!=typeof t.min_width&&(t.width=Math.max(t.width,t.min_width)),"undefined"!=typeof t.min_height&&(t.height=Math.max(t.height,t.min_height)),t._id=++a,t._dirty=!0,t.auto_position){this._sort_nodes();for(var i=0;;++i){var s=i%this.width,o=Math.floor(i/this.width);if(!(s+t.width>this.width||e.find(this.nodes,function(e){return n.is_intercepted({x:s,y:o,width:t.width,height:t.height},e)}))){t.x=s,t.y=o;break}}}return this.nodes.push(t),this._fix_collisions(t),this._pack_nodes(),this._notify(),t},s.prototype.remove_node=function(t){t._id=null,this.nodes=e.without(this.nodes,t),this._pack_nodes(),this._notify(t)},s.prototype.can_move_node=function(i,n,a,o,r){var h=Boolean(e.find(this.nodes,function(t){return t.locked}));if(!this.height&&!h)return!0;var d,_=new s(this.width,null,this["float"],0,e.map(this.nodes,function(e){return e==i?d=t.extend({},e):t.extend({},e)}));_.move_node(d,n,a,o,r);var c=!0;return h&&(c&=!Boolean(e.find(_.nodes,function(t){return t!=d&&Boolean(t.locked)&&Boolean(t._dirty)}))),this.height&&(c&=_.get_grid_height()<=this.height),c},s.prototype.can_be_placed_with_respect_to_height=function(i){if(!this.height)return!0;var n=new s(this.width,null,this["float"],0,e.map(this.nodes,function(e){return t.extend({},e)}));return n.add_node(i),n.get_grid_height()<=this.height},s.prototype.move_node=function(t,e,i,n,a,s){if("number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof n&&(n=t.width),"number"!=typeof a&&(a=t.height),"undefined"!=typeof t.max_width&&(n=Math.min(n,t.max_width)),"undefined"!=typeof t.max_height&&(a=Math.min(a,t.max_height)),"undefined"!=typeof t.min_width&&(n=Math.max(n,t.min_width)),"undefined"!=typeof t.min_height&&(a=Math.max(a,t.min_height)),t.x==e&&t.y==i&&t.width==n&&t.height==a)return t;var o=t.width!=n;return t._dirty=!0,t.x=e,t.y=i,t.width=n,t.height=a,t=this._prepare_node(t,o),this._fix_collisions(t),s||(this._pack_nodes(),this._notify()),t},s.prototype.get_grid_height=function(){return e.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)},s.prototype.begin_update=function(t){e.each(this.nodes,function(t){t._orig_y=t.y}),t._updating=!0},s.prototype.end_update=function(){e.each(this.nodes,function(t){t._orig_y=t.y});var t=e.find(this.nodes,function(t){return t._updating});t&&(t._updating=!1)};var o=function(i,n){var a,o=this;this.container=t(i),n.item_class=n.item_class||"grid-stack-item";var r=this.container.closest("."+n.item_class).size()>0;this.opts=e.defaults(n||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,item_class:"grid-stack-item",placeholder_class:"grid-stack-placeholder",handle:".grid-stack-item-content",cell_width:0,cell_height:60,vertical_margin:20,auto:!0,min_width:768,"float":!1,static_grid:!1,_class:"grid-stack-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,always_show_resize_handle:n.always_show_resize_handle||!1,resizable:e.defaults(n.resizable||{},{autoHide:!n.always_show_resize_handle,handles:"se"}),draggable:e.defaults(n.draggable||{},{handle:".grid-stack-item-content",scroll:!1,appendTo:"body"}),connectWith:"",only_pass_info_to_dropped_gridstack:n.only_pass_info_to_dropped_gridstack||!1}),this.opts.cell_width=this.cell_width(),this.opts.is_nested=r,this.container.addClass(this.opts._class),this._set_static_class(),r&&this.container.addClass("grid-stack-nested"),this._init_styles();var h=o.opts.connectWith?this.opts.connectWith+" ."+o.opts.item_class:"."+this.opts._class+" ."+o.opts.item_class;if(this.container.droppable({accept:h,out:function(){},over:function(e,i){var n=i.draggable,a=n.data("_gridstack_node"),s=t(this).data("gridstack");a.previous_gridstack=a.current_gridstack,a.current_gridstack=s;var o=a.previous_gridstack;if(s!==o){var r=s.grid.add_node({x:a.x,y:a.y,width:a.width,height:a.height,max_width:a.max_width,min_width:a.min_width,max_height:a.max_height,min_height:a.min_height,auto_position:a.auto_position,no_resize:a.no_resize,no_move:a.no_move,locked:a.locked,el:s.placeholder,original_gridstack:a.original_gridstack,previous_gridstack:a.previous_gridstack,current_gridstack:a.current_gridstack});n.data("_gridstack_node",r),o.grid.remove_node(a),o.placeholder.hide(),s.placeholder.attr("data-gs-x",n.attr("data-gs-x")).attr("data-gs-y",n.attr("data-gs-y")).attr("data-gs-width",n.attr("data-gs-width")).attr("data-gs-height",n.attr("data-gs-height")).show(),o._update_container_height()}}}),this.grid=new s(this.opts.width,function(t){var i=0;e.each(t,function(t){null==t._id?t.el.remove():(t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height),i=Math.max(i,t.y+t.height))}),o._update_styles(i+10)},this.opts["float"],this.opts.height),this.opts.auto){var d=[],_=this;this.container.children("."+this.opts.item_class).each(function(e,i){i=t(i),d.push({el:i,i:parseInt(i.attr("data-gs-x"))+parseInt(i.attr("data-gs-y"))*_.opts.width})}),e.chain(d).sortBy(function(t){return t.i}).each(function(t){o._prepare_element(t.el)}).value()}this.set_animation(this.opts.animate),this.placeholder=t('<div class="'+this.opts.placeholder_class+" "+this.opts.item_class+'"><div class="placeholder-content" /></div>').hide(),this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin),this.on_resize_handler=function(){if(o._is_one_column_mode()){if(a)return;a=!0,o.grid._sort_nodes(),e.each(o.grid.nodes,function(t){o.container.append(t.el),o.opts.static_grid||(t.no_move||t.el.draggable("disable"),t.no_resize||t.el.resizable("disable"))})}else{if(!a)return;if(a=!1,o.opts.static_grid)return;e.each(o.grid.nodes,function(t){t.no_move||t.el.draggable("enable"),t.no_resize||t.el.resizable("enable")})}},t(window).resize(this.on_resize_handler),this.on_resize_handler()};return o.prototype._trigger_change_event=function(t){var e=this.grid.get_dirty_nodes(),i=!1,n=[];e&&e.length&&(n.push(e),i=!0),(i||t===!0)&&this.container.trigger("change",n)},o.prototype._init_styles=function(){this._styles_id&&t('[data-gs-id="'+this._styles_id+'"]').remove(),this._styles_id="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=n.create_stylesheet(this._styles_id),null!=this._styles&&(this._styles._max=0)},o.prototype._update_styles=function(t){if(null!=this._styles){var e="."+this.opts._class+" ."+this.opts.item_class;if("undefined"==typeof t&&(t=this._styles._max,this._init_styles(),this._update_container_height()),0==this._styles._max&&n.insert_css_rule(this._styles,e,"min-height: "+this.opts.cell_height+"px;",0),t>this._styles._max){for(var i=this._styles._max;t>i;++i)n.insert_css_rule(this._styles,e+'[data-gs-height="'+(i+1)+'"]',"height: "+(this.opts.cell_height*(i+1)+this.opts.vertical_margin*i)+"px;",i),n.insert_css_rule(this._styles,e+'[data-gs-min-height="'+(i+1)+'"]',"min-height: "+(this.opts.cell_height*(i+1)+this.opts.vertical_margin*i)+"px;",i),n.insert_css_rule(this._styles,e+'[data-gs-max-height="'+(i+1)+'"]',"max-height: "+(this.opts.cell_height*(i+1)+this.opts.vertical_margin*i)+"px;",i),n.insert_css_rule(this._styles,e+'[data-gs-y="'+i+'"]',"top: "+(this.opts.cell_height*i+this.opts.vertical_margin*i)+"px;",i);this._styles._max=t}}},o.prototype._update_container_height=function(){this.grid._update_counter||this.container.height(this.grid.get_grid_height()*(this.opts.cell_height+this.opts.vertical_margin)-this.opts.vertical_margin)},o.prototype._is_one_column_mode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.min_width},o.prototype._prepare_element=function(e){var i=this;e=t(e),e.addClass(this.opts.item_class);var a=i.grid.add_node({x:e.attr("data-gs-x"),y:e.attr("data-gs-y"),width:e.attr("data-gs-width"),height:e.attr("data-gs-height"),max_width:e.attr("data-gs-max-width"),min_width:e.attr("data-gs-min-width"),max_height:e.attr("data-gs-max-height"),min_height:e.attr("data-gs-min-height"),auto_position:n.toBool(e.attr("data-gs-auto-position")),no_resize:n.toBool(e.attr("data-gs-no-resize")),no_move:n.toBool(e.attr("data-gs-no-move")),locked:n.toBool(e.attr("data-gs-locked")),el:e,original_gridstack:i,previous_gridstack:i,current_gridstack:i});e.data("_gridstack_node",a),i.opts.static_grid||(i.init_draggable(e),(a.no_move||this._is_one_column_mode())&&e.draggable("disable"),(a.no_resize||this._is_one_column_mode())&&e.resizable("disable"),e.attr("data-gs-locked",a.locked?"yes":null))},o.prototype.init_draggable=function(i){var n=this;i=t(i);var a=function(){n.container.append(n.placeholder);var e=t(this),i=e.data("_gridstack_node"),a=i.current_gridstack;e.hide(),a.grid.clean_nodes(),a.grid.begin_update(i),a.placeholder.attr("data-gs-x",e.attr("data-gs-x")).attr("data-gs-y",e.attr("data-gs-y")).attr("data-gs-width",e.attr("data-gs-width")).attr("data-gs-height",e.attr("data-gs-height")).show(),i.el=a.placeholder},s=function(){n.placeholder.detach();var e=t(this),i=e.data("_gridstack_node");if(i){var a=i.previous_gridstack,s=i.current_gridstack,o=i.original_gridstack;if(i.el=e,o===s){i.previous_gridstack=i.current_gridstack;var r=s;return r.placeholder.hide(),e.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).removeAttr("style"),r._update_container_height(),r._trigger_change_event(),void r.grid.end_update()}i.original_gridstack=s;var h=e.removeClass("ui-draggable-dragging").removeAttr("style data-gs-x data-gs-y").find(".ui-resizable-handle").remove().end().prop("outerHTML");s.grid.remove_node(i),n.opts.only_pass_info_to_dropped_gridstack||(s.add_widget(h,s.placeholder.attr("data-gs-x"),s.placeholder.attr("data-gs-y"),e.attr("data-gs-width"),e.attr("data-gs-height"),!1).removeAttr("data-gs-auto-position"),a.remove_widget(e)),s.placeholder.hide(),s._trigger_change_event(),a.grid.end_update(),s.grid.end_update(),e.show(),o.container.trigger("itemremove",e),s.container.trigger("itemadd",e)}};i.draggable(e.extend(this.opts.draggable,{helper:function(){var e=t(this);n.opts.cell_width=n.cell_width();var i=n.opts.cell_width*e.attr("data-gs-width"),a=n.opts.cell_height*e.attr("data-gs-height");return e.clone().css({width:i,height:a})},start:a,stop:s,drag:function(e,i){var a=t(this).data("_gridstack_node"),s=a.current_gridstack,o=i.offset.left-s.container.offset().left,r=i.offset.top-s.container.offset().top,h=Math.round(o/n.opts.cell_width),d=Math.floor((r+n.opts.cell_height/2)/n.opts.cell_height);s.grid.can_move_node(a,h,d,a.width,a.height)&&(s.grid.move_node(a,h,d),s._update_container_height())},containment:this.opts.is_nested?this.container.parent():null})).resizable(e.extend(this.opts.resizable,{start:a,stop:s,resize:function(e,i){var a=t(this).data("_gridstack_node"),s=a.current_gridstack;n.opts.cell_width=n.cell_width();var o=Math.round(i.size.width/n.opts.cell_width),r=Math.round(i.size.height/n.opts.cell_height);s.grid.can_move_node(a,a.x,a.y,o,r)&&(s.grid.move_node(a,a.x,a.y,o,r),s._update_container_height())}}))},o.prototype.set_animation=function(t){t?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},o.prototype.add_widget=function(e,i,n,a,s,o){return e=t(e),"undefined"!=typeof i&&e.attr("data-gs-x",i),"undefined"!=typeof n&&e.attr("data-gs-y",n),"undefined"!=typeof a&&e.attr("data-gs-width",a),"undefined"!=typeof s&&e.attr("data-gs-height",s),"undefined"!=typeof o&&e.attr("data-gs-auto-position",o?"yes":null),this.container.append(e),this._prepare_element(e),this._update_container_height(),this._trigger_change_event(!0),e},o.prototype.will_it_fit=function(t,e,i,n,a){var s={x:t,y:e,width:i,height:n,auto_position:a};return this.grid.can_be_placed_with_respect_to_height(s)},o.prototype.remove_widget=function(e,i){i="undefined"==typeof i?!0:i,e=t(e);var n=e.data("_gridstack_node");this.grid.remove_node(n),e.removeData("_gridstack_node"),this._update_container_height(),i&&e.remove(),this._trigger_change_event(!0)},o.prototype.remove_all=function(t){e.each(this.grid.nodes,function(e){this.remove_widget(e.el,t)},this),this.grid.nodes=[],this._update_container_height()},o.prototype.destroy=function(){t(window).off("resize",this.on_resize_handler),this.disable(),this.container.remove(),n.remove_stylesheet(this._styles_id),this.grid&&(this.grid=null)},o.prototype.resizable=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var a=n.data("_gridstack_node");"undefined"!=typeof a&&null!=a&&(a.no_resize=!i,n.resizable(a.no_resize?"disable":"enable"))}),this},o.prototype.movable=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var a=n.data("_gridstack_node");"undefined"!=typeof a&&null!=a&&(a.no_move=!i,n.draggable(a.no_move?"disable":"enable"))}),this},o.prototype.disable=function(){this.movable(this.container.children("."+this.opts.item_class),!1),this.resizable(this.container.children("."+this.opts.item_class),!1)},o.prototype.enable=function(){this.movable(this.container.children("."+this.opts.item_class),!0),this.resizable(this.container.children("."+this.opts.item_class),!0)},o.prototype.locked=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var a=n.data("_gridstack_node");"undefined"!=typeof a&&null!=a&&(a.locked=i||!1,n.attr("data-gs-locked",a.locked?"yes":null))}),this},o.prototype.min_height=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var a=n.data("_gridstack_node");"undefined"!=typeof a&&null!=a&&(isNaN(i)||(a.min_height=i||!1,n.attr("data-gs-min-height",i)))}),this},o.prototype.min_width=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var a=n.data("_gridstack_node");"undefined"!=typeof a&&null!=a&&(isNaN(i)||(a.min_width=i||!1,n.attr("data-gs-min-width",i)))}),this},o.prototype._update_element=function(e,i){e=t(e).first();var n=e.data("_gridstack_node");if("undefined"!=typeof n&&null!=n){var a=this;a.grid.clean_nodes(),a.grid.begin_update(n),i.call(this,e,n),a._update_container_height(),a._trigger_change_event(),a.grid.end_update()}},o.prototype.resize=function(t,e,i){this._update_element(t,function(t,n){e=null!=e&&"undefined"!=typeof e?e:n.width,i=null!=i&&"undefined"!=typeof i?i:n.height,this.grid.move_node(n,n.x,n.y,e,i)})},o.prototype.move=function(t,e,i){this._update_element(t,function(t,n){e=null!=e&&"undefined"!=typeof e?e:n.x,i=null!=i&&"undefined"!=typeof i?i:n.y,this.grid.move_node(n,e,i,n.width,n.height)})},o.prototype.update=function(t,e,i,n,a){this._update_element(t,function(t,s){e=null!=e&&"undefined"!=typeof e?e:s.x,i=null!=i&&"undefined"!=typeof i?i:s.y,n=null!=n&&"undefined"!=typeof n?n:s.width,a=null!=a&&"undefined"!=typeof a?a:s.height,this.grid.move_node(s,e,i,n,a)})},o.prototype.cell_height=function(t){return"undefined"==typeof t?this.opts.cell_height:(t=parseInt(t),void(t!=this.opts.cell_height&&(this.opts.cell_height=t||this.opts.cell_height,this._update_styles())))},o.prototype.cell_width=function(){var t=this.container.find("[data-gs-width]:visible").first();return Math.ceil(t.outerWidth()/t.attr("data-gs-width"))},o.prototype.get_cell_from_pixel=function(t){var e=this.container.position(),i=t.left-e.left,n=t.top-e.top,a=Math.floor(this.container.width()/this.opts.width),s=this.opts.cell_height+this.opts.vertical_margin;return{x:Math.floor(i/a),y:Math.floor(n/s)}},o.prototype.batch_update=function(){this.grid.batch_update()},o.prototype.commit=function(){this.grid.commit(),this._update_container_height()},o.prototype.is_area_empty=function(t,e,i,n){return this.grid.is_area_empty(t,e,i,n)},o.prototype.set_static=function(t){this.opts.static_grid=t===!0,this._set_static_class()},o.prototype._set_static_class=function(){var t="grid-stack-static";this.opts.static_grid===!0?this.container.addClass(t):this.container.removeClass(t)},i.GridStackUI=o,i.GridStackUI.Utils=n,t.fn.gridstack=function(e){return this.each(function(){t(this).data("gridstack")||t(this).data("gridstack",new o(this,e))})},i.GridStackUI});